"use strict";

/* global globalRootUrl, globalTranslate, Form, Config, PbxApi */
// Constants related to the form and module
var idUrl = 'module-get-ssl'; // API endpoint for SSL module

var idForm = 'module-get-ssl-form'; // Form element ID for SSL module

var className = 'ModuleGetSsl'; // Class name for this module
// Main ModuleGetSsl class definition

var ModuleGetSsl = {
  // Cache commonly used jQuery objects
  $formObj: $('#' + idForm),
  $checkBoxes: $('#' + idForm + ' .ui.checkbox'),
  $disabilityFields: $('#' + idForm + ' .disability'),
  $statusToggle: $('#module-status-toggle'),
  $submitButton: $('#submitbutton'),
  $moduleStatus: $('#status'),
  $intervalId: undefined,
  // To manage the interval for SSL status check
  // Validation rules for the form
  validateRules: {
    domainName: {
      identifier: 'domainName',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.module_getssl_DomainNameEmpty
      }]
    }
  },

  /**
   * Initialize the module, bind event listeners, and setup the form.
   * This function is called when the document is ready.
   */
  initialize: function initialize() {
    // Initialize Semantic UI checkboxes
    this.$checkBoxes.checkbox(); // Check and set module status on load and when the status changes

    this.checkStatusToggle();
    window.addEventListener('ModuleStatusChanged', this.checkStatusToggle); // Initialize form with validation and submit handlers

    this.initializeForm();
    moduleGetSSLStatusLoopWorker.$resultBlock.hide();
  },

  /**
   * Request an SSL certificate by calling the server-side API.
   * This method sends a GET request to initiate the SSL process.
   */
  getSsl: function getSsl() {
    $.api({
      url: "".concat(Config.pbxUrl, "/pbxcore/api/modules/").concat(className, "/get-cert"),
      on: 'now',
      method: 'POST',
      beforeXHR: function beforeXHR(xhr) {
        xhr.setRequestHeader('X-Async-Response-Channel-Id', moduleGetSSLStatusLoopWorker.channelId);
        xhr.setRequestHeader('X-Processor-Timeout', '120');
        return xhr;
      },
      beforeSend: function beforeSend(settings) {
        ModuleGetSsl.$submitButton.addClass('loading disabled');
        moduleGetSSLStatusLoopWorker.$resultBlock.show();
        moduleGetSSLStatusLoopWorker.editor.getSession().setValue('');
        return settings;
      },
      successTest: PbxApi.successTest,

      /**
       * Handles the successful response of the 'get-cert' API request.
       * @param {object} response - The response object.
       */
      onSuccess: function onSuccess(response) {
        ModuleGetSsl.$submitButton.removeClass('loading disabled');
      },

      /**
       * Handles the failure response of the 'get-cert' API request.
       * @param {object} response - The response object.
       */
      onFailure: function onFailure(response) {
        ModuleGetSsl.$submitButton.removeClass('loading disabled');
        UserMessage.showMultiString(response.message);
        moduleGetSSLStatusLoopWorker.$resultBlock.hide();
      }
    });
  },

  /**
   * Toggles the form fields and status visibility based on the module's status.
   * Enables or disables form fields depending on whether the module is active.
   */
  checkStatusToggle: function checkStatusToggle() {
    // If the module status is active, enable form fields and show status
    if (ModuleGetSsl.$statusToggle.checkbox('is checked')) {
      ModuleGetSsl.$disabilityFields.removeClass('disabled');
      ModuleGetSsl.$moduleStatus.show();
    } else {
      // If the module status is inactive, disable form fields and hide status
      ModuleGetSsl.$disabilityFields.addClass('disabled');
      ModuleGetSsl.$moduleStatus.hide();
    }
  },

  /**
   * Callback before sending the form.
   * @param {Object} settings - Ajax request settings.
   * @returns {Object} The modified Ajax request settings.
   */
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = ModuleGetSsl.$formObj.form('get values');
    return result;
  },

  /**
   * Callback function after sending the form.
   */
  cbAfterSendForm: function cbAfterSendForm(response) {
    if (Form.checkSuccess(response)) {
      ModuleGetSsl.getSsl();
    }
  },

  /**
   * Initializes the form validation and submission logic.
   * Sets up callbacks and validation rules for the form.
   */
  initializeForm: function initializeForm() {
    // Assign form-related settings to the Form object
    Form.$formObj = ModuleGetSsl.$formObj;
    Form.url = "".concat(globalRootUrl).concat(idUrl, "/").concat(idUrl, "/save");
    Form.validateRules = ModuleGetSsl.validateRules;
    Form.enableDirrity = false;
    Form.cbAfterSendForm = ModuleGetSsl.cbAfterSendForm;
    Form.cbBeforeSendForm = ModuleGetSsl.cbBeforeSendForm; // Initialize the form with the specified parameters

    Form.initialize();
  }
}; // Initialize the ModuleGetSsl class when the document is ready

$(document).ready(function () {
  ModuleGetSsl.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtZ2V0LXNzbC1pbmRleC5qcyJdLCJuYW1lcyI6WyJpZFVybCIsImlkRm9ybSIsImNsYXNzTmFtZSIsIk1vZHVsZUdldFNzbCIsIiRmb3JtT2JqIiwiJCIsIiRjaGVja0JveGVzIiwiJGRpc2FiaWxpdHlGaWVsZHMiLCIkc3RhdHVzVG9nZ2xlIiwiJHN1Ym1pdEJ1dHRvbiIsIiRtb2R1bGVTdGF0dXMiLCIkaW50ZXJ2YWxJZCIsInVuZGVmaW5lZCIsInZhbGlkYXRlUnVsZXMiLCJkb21haW5OYW1lIiwiaWRlbnRpZmllciIsInJ1bGVzIiwidHlwZSIsInByb21wdCIsImdsb2JhbFRyYW5zbGF0ZSIsIm1vZHVsZV9nZXRzc2xfRG9tYWluTmFtZUVtcHR5IiwiaW5pdGlhbGl6ZSIsImNoZWNrYm94IiwiY2hlY2tTdGF0dXNUb2dnbGUiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiaW5pdGlhbGl6ZUZvcm0iLCJtb2R1bGVHZXRTU0xTdGF0dXNMb29wV29ya2VyIiwiJHJlc3VsdEJsb2NrIiwiaGlkZSIsImdldFNzbCIsImFwaSIsInVybCIsIkNvbmZpZyIsInBieFVybCIsIm9uIiwibWV0aG9kIiwiYmVmb3JlWEhSIiwieGhyIiwic2V0UmVxdWVzdEhlYWRlciIsImNoYW5uZWxJZCIsImJlZm9yZVNlbmQiLCJzZXR0aW5ncyIsImFkZENsYXNzIiwic2hvdyIsImVkaXRvciIsImdldFNlc3Npb24iLCJzZXRWYWx1ZSIsInN1Y2Nlc3NUZXN0IiwiUGJ4QXBpIiwib25TdWNjZXNzIiwicmVzcG9uc2UiLCJyZW1vdmVDbGFzcyIsIm9uRmFpbHVyZSIsIlVzZXJNZXNzYWdlIiwic2hvd011bHRpU3RyaW5nIiwibWVzc2FnZSIsImNiQmVmb3JlU2VuZEZvcm0iLCJyZXN1bHQiLCJkYXRhIiwiZm9ybSIsImNiQWZ0ZXJTZW5kRm9ybSIsIkZvcm0iLCJjaGVja1N1Y2Nlc3MiLCJnbG9iYWxSb290VXJsIiwiZW5hYmxlRGlycml0eSIsImRvY3Vt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TUFBYjtBQUNBO0FBQ0QsR0FuSG1COztBQXNIcEI7QUFDRDtBQUNBO0FBQ0E7QUFDQ0osRUFBQUEsY0ExSG9CLDRCQTBISDtBQUNoQjtBQUNBb0MsSUFBQUEsSUFBSSxDQUFDMUQsUUFBTCxHQUFnQkQsWUFBWSxDQUFDQyxRQUE3QjtBQUNBMEQsSUFBQUEsSUFBSSxDQUFDOUIsR0FBTCxhQUFjZ0MsYUFBZCxTQUE4QmhFLEtBQTlCLGNBQXVDQSxLQUF2QztBQUNBOEQsSUFBQUEsSUFBSSxDQUFDakQsYUFBTCxHQUFxQlYsWUFBWSxDQUFDVSxhQUFsQztBQUNBaUQsSUFBQUEsSUFBSSxDQUFDRyxhQUFMLEdBQXFCLEtBQXJCO0FBQ0FILElBQUFBLElBQUksQ0FBQ0QsZUFBTCxHQUF1QjFELFlBQVksQ0FBQzBELGVBQXBDO0FBQ0FDLElBQUFBLElBQUksQ0FBQ0wsZ0JBQUwsR0FBd0J0RCxZQUFZLENBQUNzRCxnQkFBckMsQ0FQZ0IsQ0FRaEI7O0FBQ0FLLElBQUFBLElBQUksQ0FBQ3pDLFVBQUw7QUFDQTtBQXBJbUIsQ0FBckIsQyxDQXVJQTs7QUFDQWhCLENBQUMsQ0FBQzZELFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkJoRSxFQUFBQSxZQUFZLENBQUNrQixVQUFiO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLCBnbG9iYWxUcmFuc2xhdGUsIEZvcm0sIENvbmZpZywgUGJ4QXBpICovXG5cbi8vIENvbnN0YW50cyByZWxhdGVkIHRvIHRoZSBmb3JtIGFuZCBtb2R1bGVcbmNvbnN0IGlkVXJsICAgICA9ICdtb2R1bGUtZ2V0LXNzbCc7ICAgICAgICAgICAgICAvLyBBUEkgZW5kcG9pbnQgZm9yIFNTTCBtb2R1bGVcbmNvbnN0IGlkRm9ybSAgICA9ICdtb2R1bGUtZ2V0LXNzbC1mb3JtJzsgICAgICAgICAvLyBGb3JtIGVsZW1lbnQgSUQgZm9yIFNTTCBtb2R1bGVcbmNvbnN0IGNsYXNzTmFtZSA9ICdNb2R1bGVHZXRTc2wnOyAgICAgICAgICAgICAgICAvLyBDbGFzcyBuYW1lIGZvciB0aGlzIG1vZHVsZVxuXG4vLyBNYWluIE1vZHVsZUdldFNzbCBjbGFzcyBkZWZpbml0aW9uXG5jb25zdCBNb2R1bGVHZXRTc2wgPSB7XG5cdC8vIENhY2hlIGNvbW1vbmx5IHVzZWQgalF1ZXJ5IG9iamVjdHNcblx0JGZvcm1PYmo6ICQoJyMnICsgaWRGb3JtKSxcblx0JGNoZWNrQm94ZXM6ICQoJyMnICsgaWRGb3JtICsgJyAudWkuY2hlY2tib3gnKSxcblx0JGRpc2FiaWxpdHlGaWVsZHM6ICQoJyMnICsgaWRGb3JtICsgJyAuZGlzYWJpbGl0eScpLFxuXHQkc3RhdHVzVG9nZ2xlOiAkKCcjbW9kdWxlLXN0YXR1cy10b2dnbGUnKSxcblx0JHN1Ym1pdEJ1dHRvbjogJCgnI3N1Ym1pdGJ1dHRvbicpLFxuXHQkbW9kdWxlU3RhdHVzOiAkKCcjc3RhdHVzJyksXG5cdCRpbnRlcnZhbElkOiB1bmRlZmluZWQsIC8vIFRvIG1hbmFnZSB0aGUgaW50ZXJ2YWwgZm9yIFNTTCBzdGF0dXMgY2hlY2tcblxuXHQvLyBWYWxpZGF0aW9uIHJ1bGVzIGZvciB0aGUgZm9ybVxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0ZG9tYWluTmFtZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ2RvbWFpbk5hbWUnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUubW9kdWxlX2dldHNzbF9Eb21haW5OYW1lRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cblx0LyoqXG5cdCAqIEluaXRpYWxpemUgdGhlIG1vZHVsZSwgYmluZCBldmVudCBsaXN0ZW5lcnMsIGFuZCBzZXR1cCB0aGUgZm9ybS5cblx0ICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiB0aGUgZG9jdW1lbnQgaXMgcmVhZHkuXG5cdCAqL1xuXHRpbml0aWFsaXplKCkge1xuXHRcdC8vIEluaXRpYWxpemUgU2VtYW50aWMgVUkgY2hlY2tib3hlc1xuXHRcdHRoaXMuJGNoZWNrQm94ZXMuY2hlY2tib3goKTtcblxuXHRcdC8vIENoZWNrIGFuZCBzZXQgbW9kdWxlIHN0YXR1cyBvbiBsb2FkIGFuZCB3aGVuIHRoZSBzdGF0dXMgY2hhbmdlc1xuXHRcdHRoaXMuY2hlY2tTdGF0dXNUb2dnbGUoKTtcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignTW9kdWxlU3RhdHVzQ2hhbmdlZCcsIHRoaXMuY2hlY2tTdGF0dXNUb2dnbGUpO1xuXG5cdFx0Ly8gSW5pdGlhbGl6ZSBmb3JtIHdpdGggdmFsaWRhdGlvbiBhbmQgc3VibWl0IGhhbmRsZXJzXG5cdFx0dGhpcy5pbml0aWFsaXplRm9ybSgpO1xuXG5cdFx0bW9kdWxlR2V0U1NMU3RhdHVzTG9vcFdvcmtlci4kcmVzdWx0QmxvY2suaGlkZSgpO1xuXHR9LFxuXG5cdC8qKlxuXHQgKiBSZXF1ZXN0IGFuIFNTTCBjZXJ0aWZpY2F0ZSBieSBjYWxsaW5nIHRoZSBzZXJ2ZXItc2lkZSBBUEkuXG5cdCAqIFRoaXMgbWV0aG9kIHNlbmRzIGEgR0VUIHJlcXVlc3QgdG8gaW5pdGlhdGUgdGhlIFNTTCBwcm9jZXNzLlxuXHQgKi9cblx0Z2V0U3NsKCkge1xuXHRcdCQuYXBpKHtcblx0XHRcdHVybDogYCR7Q29uZmlnLnBieFVybH0vcGJ4Y29yZS9hcGkvbW9kdWxlcy8ke2NsYXNzTmFtZX0vZ2V0LWNlcnRgLFxuXHRcdFx0b246ICdub3cnLFxuXHRcdFx0bWV0aG9kOiAnUE9TVCcsXG5cdFx0XHRiZWZvcmVYSFIoeGhyKSB7XG5cdFx0XHRcdHhoci5zZXRSZXF1ZXN0SGVhZGVyICgnWC1Bc3luYy1SZXNwb25zZS1DaGFubmVsLUlkJywgbW9kdWxlR2V0U1NMU3RhdHVzTG9vcFdvcmtlci5jaGFubmVsSWQpO1xuXHRcdFx0XHR4aHIuc2V0UmVxdWVzdEhlYWRlciAoJ1gtUHJvY2Vzc29yLVRpbWVvdXQnLCAnMTIwJyk7XG5cdFx0XHRcdHJldHVybiB4aHI7XG5cdFx0XHR9LFxuXHRcdFx0YmVmb3JlU2VuZChzZXR0aW5ncykge1xuXHRcdFx0XHRNb2R1bGVHZXRTc2wuJHN1Ym1pdEJ1dHRvbi5hZGRDbGFzcygnbG9hZGluZyBkaXNhYmxlZCcpO1xuXHRcdFx0XHRtb2R1bGVHZXRTU0xTdGF0dXNMb29wV29ya2VyLiRyZXN1bHRCbG9jay5zaG93KCk7XG5cdFx0XHRcdG1vZHVsZUdldFNTTFN0YXR1c0xvb3BXb3JrZXIuZWRpdG9yLmdldFNlc3Npb24oKS5zZXRWYWx1ZSgnJyk7XG5cdFx0XHRcdHJldHVybiBzZXR0aW5ncztcblx0XHRcdH0sXG5cdFx0XHRzdWNjZXNzVGVzdDogUGJ4QXBpLnN1Y2Nlc3NUZXN0LFxuXHRcdFx0LyoqXG5cdFx0XHQgKiBIYW5kbGVzIHRoZSBzdWNjZXNzZnVsIHJlc3BvbnNlIG9mIHRoZSAnZ2V0LWNlcnQnIEFQSSByZXF1ZXN0LlxuXHRcdFx0ICogQHBhcmFtIHtvYmplY3R9IHJlc3BvbnNlIC0gVGhlIHJlc3BvbnNlIG9iamVjdC5cblx0XHRcdCAqL1xuXHRcdFx0b25TdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcblx0XHRcdFx0TW9kdWxlR2V0U3NsLiRzdWJtaXRCdXR0b24ucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcgZGlzYWJsZWQnKTtcblx0XHRcdH0sXG5cdFx0XHQvKipcblx0XHRcdCAqIEhhbmRsZXMgdGhlIGZhaWx1cmUgcmVzcG9uc2Ugb2YgdGhlICdnZXQtY2VydCcgQVBJIHJlcXVlc3QuXG5cdFx0XHQgKiBAcGFyYW0ge29iamVjdH0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2Ugb2JqZWN0LlxuXHRcdFx0ICovXG5cdFx0XHRvbkZhaWx1cmU6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdE1vZHVsZUdldFNzbC4kc3VibWl0QnV0dG9uLnJlbW92ZUNsYXNzKCdsb2FkaW5nIGRpc2FibGVkJyk7XG5cdFx0XHRcdFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcblx0XHRcdFx0bW9kdWxlR2V0U1NMU3RhdHVzTG9vcFdvcmtlci4kcmVzdWx0QmxvY2suaGlkZSgpO1xuXHRcdFx0fSxcblx0XHR9KVxuXHR9LFxuXG5cdC8qKlxuXHQgKiBUb2dnbGVzIHRoZSBmb3JtIGZpZWxkcyBhbmQgc3RhdHVzIHZpc2liaWxpdHkgYmFzZWQgb24gdGhlIG1vZHVsZSdzIHN0YXR1cy5cblx0ICogRW5hYmxlcyBvciBkaXNhYmxlcyBmb3JtIGZpZWxkcyBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgbW9kdWxlIGlzIGFjdGl2ZS5cblx0ICovXG5cdGNoZWNrU3RhdHVzVG9nZ2xlKCkge1xuXHRcdC8vIElmIHRoZSBtb2R1bGUgc3RhdHVzIGlzIGFjdGl2ZSwgZW5hYmxlIGZvcm0gZmllbGRzIGFuZCBzaG93IHN0YXR1c1xuXHRcdGlmIChNb2R1bGVHZXRTc2wuJHN0YXR1c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKSB7XG5cdFx0XHRNb2R1bGVHZXRTc2wuJGRpc2FiaWxpdHlGaWVsZHMucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRNb2R1bGVHZXRTc2wuJG1vZHVsZVN0YXR1cy5zaG93KCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIElmIHRoZSBtb2R1bGUgc3RhdHVzIGlzIGluYWN0aXZlLCBkaXNhYmxlIGZvcm0gZmllbGRzIGFuZCBoaWRlIHN0YXR1c1xuXHRcdFx0TW9kdWxlR2V0U3NsLiRkaXNhYmlsaXR5RmllbGRzLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0TW9kdWxlR2V0U3NsLiRtb2R1bGVTdGF0dXMuaGlkZSgpO1xuXHRcdH1cblx0fSxcblxuXHQvKipcblx0ICogQ2FsbGJhY2sgYmVmb3JlIHNlbmRpbmcgdGhlIGZvcm0uXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyAtIEFqYXggcmVxdWVzdCBzZXR0aW5ncy5cblx0ICogQHJldHVybnMge09iamVjdH0gVGhlIG1vZGlmaWVkIEFqYXggcmVxdWVzdCBzZXR0aW5ncy5cblx0ICovXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IE1vZHVsZUdldFNzbC4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblxuXHQvKipcblx0ICogQ2FsbGJhY2sgZnVuY3Rpb24gYWZ0ZXIgc2VuZGluZyB0aGUgZm9ybS5cblx0ICovXG5cdGNiQWZ0ZXJTZW5kRm9ybShyZXNwb25zZSkge1xuXHRcdGlmIChGb3JtLmNoZWNrU3VjY2VzcyhyZXNwb25zZSkpe1xuXHRcdFx0TW9kdWxlR2V0U3NsLmdldFNzbCgpO1xuXHRcdH1cblx0fSxcblxuXG5cdC8qKlxuXHQgKiBJbml0aWFsaXplcyB0aGUgZm9ybSB2YWxpZGF0aW9uIGFuZCBzdWJtaXNzaW9uIGxvZ2ljLlxuXHQgKiBTZXRzIHVwIGNhbGxiYWNrcyBhbmQgdmFsaWRhdGlvbiBydWxlcyBmb3IgdGhlIGZvcm0uXG5cdCAqL1xuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHQvLyBBc3NpZ24gZm9ybS1yZWxhdGVkIHNldHRpbmdzIHRvIHRoZSBGb3JtIG9iamVjdFxuXHRcdEZvcm0uJGZvcm1PYmogPSBNb2R1bGVHZXRTc2wuJGZvcm1PYmo7XG5cdFx0Rm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfSR7aWRVcmx9LyR7aWRVcmx9L3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IE1vZHVsZUdldFNzbC52YWxpZGF0ZVJ1bGVzO1xuXHRcdEZvcm0uZW5hYmxlRGlycml0eSA9IGZhbHNlO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gTW9kdWxlR2V0U3NsLmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBNb2R1bGVHZXRTc2wuY2JCZWZvcmVTZW5kRm9ybTtcblx0XHQvLyBJbml0aWFsaXplIHRoZSBmb3JtIHdpdGggdGhlIHNwZWNpZmllZCBwYXJhbWV0ZXJzXG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG4vLyBJbml0aWFsaXplIHRoZSBNb2R1bGVHZXRTc2wgY2xhc3Mgd2hlbiB0aGUgZG9jdW1lbnQgaXMgcmVhZHlcbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0TW9kdWxlR2V0U3NsLmluaXRpYWxpemUoKTtcbn0pOyJdfQ==